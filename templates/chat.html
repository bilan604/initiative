<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        #chat-container {
            position: absolute;
            top: 0%;
            left: 0%;
            height: 75%;
            width: 100%;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
        }
        #input-container {
            position: absolute;
            top: 80%;
            left: 0%;
            height: 15%;
            width: 100%;
            display: flex;
            padding: 10px;
            background-color: #f5f5f5;
        }
        #message-input {
            position: relative;
            top: 0%;
            left: 0%;
            width: 80%;
            height: 100%;
            flex-grow: 1;
            padding: 5px;
            resize: none; /* Disable user resizing of the textarea */
            overflow-y: auto; /* Enable vertical scrolling when necessary */
        }
        #send-button {
            position: relative;
            top: 20%;
            left: 0%;
            width:10%;
            height: 60%;
            padding: 5px 10px;
            margin-left: 10px;
            cursor: pointer;
        }
        .user-message {
          background-color: rgb(128, 176, 255);
          border: 1px solid #000000;
        }
        .response-message {
          background-color: rgb(119, 255, 194);
          border: 1px solid #000000;
        }
    </style>
    <title>Chat Interface</title>
    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

    <div id="chat-container">
        
    </div>

    <div id="input-container">
        <textarea id="message-input" placeholder="Type your message..."></textarea>
        <button id="send-button">Send</button>
    </div>

    <script>
        
        function renderMessages(responseData) {
            let messageElements = [];
            for (let i=0; i<responseData.length; i++) {
                if (i % 2 == 0) {
                    let messageElement = `<div class="user-message">${responseData[i]}</div>`
                    messageElements.push(messageElement);
                } else {
                    let messageElement = `<div class="response-message">${responseData[i]}</div>`
                    messageElements.push(messageElement);
                }
            }

            let messagesHTML = messageElements.join("\n");
            return messagesHTML;
        }

        $(document).ready(function () {
            
            // Make an AJAX request to your Flask route with a POST method
             $.ajax({
                     type: "POST",
                     url: "/messages/",  // Update with your Flask route
                     data: {"input": "", "isFirstLoad": "TRUE"},  // Pass user input to the server
                     success: function (data) {
                         // Update the content with the response from the server
                         // data is of type object, a list of message strings for the corresponding chat
                         var arr = JSON.parse(data);
                         let messages = renderMessages(arr);
                         $("#chat-container").html(messages);
                     },
                     error: function (error) {
                         console.log(error);
                     }
                 });

            // Define the click event for the button
            $("#send-button").click(function () {
                // Get the user input from the text input
                var userInput = $("#message-input").val();

                // Clear user input to indicate message has been sent
                document.getElementById("message-input").value = "";
    
                // Make an AJAX request to your Flask route with a POST method
                $.ajax({
                    type: "POST",
                    url: "/messages/",  // Update with your Flask route
                    data: {"input": userInput},  // Pass user input to the server
                    success: function (data) {
                        // Update the content with the response from the server
                        console.log("re-rendering page----------------------------->");
                        //console.log("chat-container.innerHTML", document.getElementById('chat-container').innerHTML);
                        console.log("data:", data);
                        console.log(typeof data);
                        
                        // data is of type object, a list of message strings for the corresponding chat
                        var arr = JSON.parse(data);
                        let messages = renderMessages(arr);
                        
                        $("#chat-container").html(messages);
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            });
        });
    </script>

</body>
</html>
